<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Write your site description here. It will be used as your sites meta description as well!">

    <title>Python and pyserial on a WRT54G router - Gábor Molnár</title>

    <link rel="canonical" href="http://gabor.molnar.es/blog/2010/05/29/python-and-pyserial-on-wrt54g-router/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-1277369-13', 'auto');
      ga('send', 'pageview');
    </script>

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Gábor Molnár</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Python and pyserial on a WRT54G router</h1>
                    
                    <span class="meta">Posted by Gábor Molnár on May 29, 2010</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<!-- more -->

<p>I&#39;ve been trying to install python with serial support on a WRT54G router running openwrt for a day, and now it&#39;s done :)</p>

<p>The problem was that the router has only 4Mb of flash memory, and the whole operating system must fit into this space. The openwrt distribution itself is about 3Mb, without python installed. The python package is 2Mb, and it occupies 4Mb or more when installed.</p>

<p>The first solution is that you expand the storage capacity of your router by attaching an SD-card to it. You can do this easily, <a href="http://www.yourwarrantyisvoid.com/2009/09/09/add-an-sd-card-slot-to-a-wrt54g-v2/">this guide</a> will help, and there is a lot of other tutorials out there.</p>

<p>But if you want to do it without soldering, or buying anything, there is an another solution: I&#39;ve made a custom openwrt image. I wanted the router to connect to a  wireless network, but I didn&#39;t need the access point functionality, so I&#39;ve cut it out, and used python-mini instead of python. The created image file was only 3.2Mb.</p>

<p>First of all, you have to use linux to do this. If you don&#39;t have one installed, you could use an Ubuntu LiveCD, or an other Linux LiveCD.</p>

<p>The first step is to download the openwrt ImageBuilder. I suggest using the newest openwrt release, which is at the time of writing Backfire, for which the ImageBuilder can be downloaded <a href="http://wiki.openwrt.org/doc/howto/obtain.firmware.generate">from here</a>.</p>

<p>After unpacking it, I used the following command to build the images:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make image <span class="nv">PROFILE</span><span class="o">=</span><span class="s2">&quot;Broadcom-b43&quot;</span> <span class="nv">PACKAGES</span><span class="o">=</span><span class="s2">&quot;-dnsmasq -e2fsprogs -kmod-fs-ext3 -kmod-ppp -kmod-pppoe -kmod-scsi-core -kmod-usb-core -kmod-usb-ohci -kmod-usb-storage -kmod-usb2 -ppp -ppp-mod-pppoe -iptables -iptables-mod-conntrack -iptables-mod-nat -kmod-ipt-conntrack -kmod-ipt-core -kmod-ipt-nat -kmod-ipt-nathelper -firewall -mtd -nvram python-mini pyserial&quot;</span>
</code></pre></div>
<p>As you can see, a lot of things were cut out, like ext3, usb, scsi, ppp, and iptables support, but python-mini and pyserial were included.</p>

<p>After installation, python runs fine, but if you want to import the serial module, it won&#39;t load, because the termios module is missing from the python-mini. So what now? The first thing I found that the <a href="https://dev.openwrt.org/ticket/6897">problem was reported</a> to the developers of openwrt. After a while, I found a blog post which describes a solution for the problem. The author of the post built the openwrt python package from source, and copied the termios.so file to the device.</p>

<p>I didnt want to compile it, because it seemed difficult (at least I didnt want to read another 5 howto about building openwrt packages from source). So here is what I did:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>cp packages/python_2.6.4-3_brcm47xx.ipk /tmp/
<span class="nv">$ </span><span class="nb">cd</span> /tmp
<span class="nv">$ </span>mv  python_2.6.4-3_brcm47xx.ipk python.tar.gz
<span class="nv">$ </span>tar -xvzf python.tar.gz
<span class="nv">$ </span>tar -xvzf data.tar.gz
<span class="nv">$ </span><span class="nb">cd</span> ./usr/lib/python2.6/lib-dynload/
<span class="nv">$ </span>scp termios.so root@192.168.1.1:/usr/lib/python2.6/
</code></pre></div>
<p>As you can see, the ipk package is just a tar.gz, and you can extract the termios.so easily. After extracting, put int in the /usr/lib/python2.6 directory on the router.</p>

<p>I hope this post saves you from using google more than you would want :)</p>


                <div id="disqus_thread" style="margin-top: 2em; margin-bottom: 2em;"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES * * */
                    var disqus_shortname = 'gabor-molnar';
                    
                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/blog/2008/08/25/ubuntu-es-debian-tavoli-elerese-ssh-val/" data-toggle="tooltip" data-placement="top" title="Ubuntu és Debian távoli elérése SSH-val">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/blog/2013/05/05/javascript-programozas-jegyzet-fuggvenyek/" data-toggle="tooltip" data-placement="top" title="JavaScript programozás - Függvények">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/molnar_g">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/mr.gabor.molnar">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/molnarg">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Gábor Molnár 2015</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
